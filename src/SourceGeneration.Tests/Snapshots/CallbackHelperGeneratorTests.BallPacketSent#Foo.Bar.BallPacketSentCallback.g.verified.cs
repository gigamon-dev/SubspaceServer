//HintName: Foo.Bar.BallPacketSentCallback.g.cs
// <auto-generated>
//     Generated by the CallbackHelperGenerator
// </auto-generated>
using SS.Core.ComponentInterfaces;
using System;

#nullable enable

namespace Foo.Bar
{
    public static partial class BallPacketSentCallback
    {
        /// <summary>
        /// Registers a callback <paramref name="handler"/> on a <paramref name="broker"/>.
        /// </summary>
        /// <param name="broker">The broker to register on.</param>
        /// <param name="handler">The handler to register.</param>
        public static void Register(IComponentBroker broker, BallPacketSentDelegate handler)
        {
            broker?.RegisterCallback(handler);
        }

        /// <summary>
        /// Unregisters a callback <paramref name="handler"/> from a <paramref name="handler"/>.
        /// </summary>
        /// <param name="broker">The broker to unregister from.</param>
        /// <param name="handler">The handler to unregister.</param>
        public static void Unregister(IComponentBroker broker, BallPacketSentDelegate handler)
        {
            broker?.UnregisterCallback(handler);
        }

        /// <summary>
        /// Invokes a callback's registered handlers on a <paramref name="broker"/> and any parent broker(s).
        /// </summary>
        /// <param name="broker">The broker to invoke callback handlers on.</param>
        /// <param name="arena"><inheritdoc cref="BallPacketSentDelegate" path="/param[@name='arena']"/></param>
        /// <param name="ballPacket"><inheritdoc cref="BallPacketSentDelegate" path="/param[@name='ballPacket']"/></param>
        public static void Fire(IComponentBroker broker, global::SS.Core.Arena arena, ref readonly global::SS.Packets.Game.BallPacket ballPacket)
        {
            if (broker is null)
                return;

            BallPacketSentDelegate? callbacks = broker.GetCallback<BallPacketSentDelegate>();
            if (callbacks is not null)
                InvokeCallbacks(broker, callbacks, arena, in ballPacket);

            if (broker.Parent is not null)
                Fire(broker.Parent, arena, in ballPacket);

            // local helper (for recursion)
            static void InvokeCallbacks(IComponentBroker broker, BallPacketSentDelegate callbacks, global::SS.Core.Arena arena, ref readonly global::SS.Packets.Game.BallPacket ballPacket)
            {
                if (callbacks.HasSingleTarget)
                {
                    try
                    {
                        callbacks.Invoke(arena, in ballPacket);
                    }
                    catch (Exception ex)
                    {
                        ILogManager? logManager = broker.GetInterface<ILogManager>();
                        if (logManager is not null)
                        {
                            try
                            {
                                logManager.Log(LogLevel.Error, $"Exception caught while processing callback {nameof(BallPacketSentDelegate)}. {ex}");
                            }
                            finally
                            {
                                broker.ReleaseInterface(ref logManager);
                            }
                        }
                        else
                        {
                            Console.Error.WriteLine($"Exception caught while processing callback {nameof(BallPacketSentDelegate)}. {ex}");
                        }
                    }
                }
                else
                {
                    foreach (BallPacketSentDelegate callback in Delegate.EnumerateInvocationList(callbacks))
                    {
                        InvokeCallbacks(broker, callback, arena, in ballPacket);
                    }
                }
            }
        }
    }
}
